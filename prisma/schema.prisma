generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model accounts {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  users             users   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model conversations {
  id        String     @id @default(cuid())
  title     String?
  userId    String
  spaceId   String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  spaces    spaces?    @relation(fields: [spaceId], references: [id])
  users     users      @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages  messages[]
}

model document_indexes {
  id        String                 @id @default(cuid())
  title     String
  content   String
  url       String?
  source    String?
  sourceId  String?
  userId    String
  spaceId   String?
  embedding Unsupported("vector")?
  metadata  Json?
  createdAt DateTime               @default(now())
  updatedAt DateTime               @updatedAt
  spaces    spaces?                @relation(fields: [spaceId], references: [id])
  users     users                  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([source, sourceId])
  @@index([spaceId])
  @@index([userId])
}

model integrations {
  id          String   @id @default(cuid())
  type        String
  name        String
  userId      String
  spaceId     String?
  config      Json
  credentials Json?
  enabled     Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  spaces      spaces?  @relation(fields: [spaceId], references: [id])
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([type])
  @@index([userId])
}

model messages {
  id             String        @id @default(cuid())
  conversationId String
  role           String
  content        String
  model          String?
  provider       String?
  metadata       Json?
  createdAt      DateTime      @default(now())
  conversations  conversations @relation(fields: [conversationId], references: [id], onDelete: Cascade)

  @@index([conversationId])
}

model sessions {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model spaces {
  id               String             @id @default(cuid())
  name             String
  description      String?
  slug             String             @unique
  ownerId          String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  conversations    conversations[]
  document_indexes document_indexes[]
  integrations     integrations[]
  users            users              @relation(fields: [ownerId], references: [id], onDelete: Cascade)
}

model users {
  id                    String             @id @default(cuid())
  email                 String             @unique
  emailVerified         DateTime?
  name                  String?
  image                 String?
  password              String?
  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt
  plan                  String?            @default("free")
  subscriptionStatus    String?
  subscriptionExpiresAt DateTime?
  accounts              accounts[]
  conversations         conversations[]
  document_indexes      document_indexes[]
  integrations          integrations[]
  sessions              sessions[]
  spaces                spaces[]
}

model verification_tokens {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}
